
sudo: true

install: 
- ./install-dependencies.sh all

before_script:
- test -z "$PREFIX" || export PATH=$PATH:$PREFIX/bin

script:
- echo ENV_NAME=$ENV_NAME PREFIX=$PREFIX SRC_PREFIX=$SRC_PREFIX
- ./tools/ci/build.sh

env:
  global:
  - username=travis
  - PATH=$PATH:$HOME/bin:$HOME/usr/bin:$HOME/.local/bin/
  - Build_Deps_Default_Paths=1
  matrix:
  - ENV_NAME=production sudo=sudo
  - ENV_NAME=user-dev PREFIX=$HOME/.local
  - ENV_NAME=testing
  - ENV_NAME=

branches:
  only:
  - master
  - test
  - '/^[0-9]*\.[0-9]*\.[0-9]*/'

notifications:
  email:
    on_success: never

deploy:
  provider: releases
  api_key: $GH_ACCESS_TOKEN
  file: git-versioning-$TRAVIS_TAG.tar
  on:
    repo: dotmpe/git-versioning
    tags: true
    condition: $ENV_NAME = production

