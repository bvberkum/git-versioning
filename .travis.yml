
install: 
- test -z "$PREFIX" && ( ./install-dependencies.sh ) || ( PREFIX=$HOME/.local SRC_PREFIX=$HOME/build ./install-dependencies.sh )
- chown -R $username /home/$username/.local

before_script:
- test -z "$PREFIX" || export PATH=$PATH:$PREFIX/bin

script:
- echo ENV=$ENV PREFIX=$PREFIX SRC_PREFIX=$SRC_PREFIX
- ./tools/ci/build.sh

branches:
  only:
  - master
  - test
  - '/^[0-9]*\.[0-9]*\.[0-9]*/'

env:
  global:
  - username=travis
  matrix:
  - ENV=production
  - ENV=user-dev PREFIX=$HOME/.local
  - ENV=testing
  - ENV=

deploy:
  provider: releases
  api_key: $GH_ACCESS_TOKEN
  file: git-versioning-$TRAVIS_TAG.tar
  on:
    repo: dotmpe/git-versioning
    tags: true
    condition: $ENV = production

